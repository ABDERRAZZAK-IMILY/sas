#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define max 50

int count = 0;

struct reservation {
    char nom[50];
    char prenom[50];
    char Tele[50];
    int age;
    char statut[50];
    char date[50];
};

struct reservation res[max];



 void statistique() {
     int total = count;
     int statValide = 0, statReporte = 0, statAnnule = 0, statTraite = 0;
 int age0_18 = 0, age19_35 = 0, age36_plus = 0;
 int ageTotal = 0;
 for (int i = 0; i < total; i++) {
 ageTotal += res[i].age;
 if (res[i].age <= 18) {
 age0_18++;
 } else if (res[i].age <= 35) {
 age19_35++;
 } else {
 age36_plus++;
 }
 if (strcmp(res[i].statut, "valide") == 0) {
 statValide++;
 } else if (strcmp(res[i].statut, "reporte") == 0) {
 statReporte++;
 } else if (strcmp(res[i].statut, "annule") == 0) {
 statAnnule++;
 } else if (strcmp(res[i].statut, "traite") == 0) {
 statTraite++;
 }
 }
 printf("Moyenne d'age des patients: %.2f\n", (float)ageTotal / total);
 printf("Nombre de patients 0-18 ans: %d\n", age0_18);
 printf("Nombre de patients 19-35 ans: %d\n", age19_35);
 printf("Nombre de patients 36+ ans: %d\n", age36_plus);
 printf("Reservations validees: %d\n", statValide);
 printf("Reservations reportees: %d\n", statReporte);
 printf("Reservations annulees: %d\n", statAnnule);
 printf("Reservations traitees: %d\n", statTraite);
 }


void suppimer() {
    int mod;
    printf("entre le ref ");
    scanf("%d", &mod);
    if (mod > 0 && mod <= count) {
        for (int i = mod - 1; i < count - 1; i++) {
            strcpy(res[i].nom, res[i + 1].nom);
            strcpy(res[i].prenom, res[i + 1].prenom);
            strcpy(res[i].Tele, res[i + 1].Tele);
            res[i].age = res[i + 1].age;
            strcpy(res[i].statut, res[i + 1].statut);
            strcpy(res[i].date, res[i + 1].date);
            }
            printf("le ref est supreme");
        count--;
    } else {
        printf("invalid ref!!!\n");
    }
}

void menu() {
    printf("--------------------------------------------------------------------------------------------------\n");
    printf("entre le nombre de l operation :\n");
    printf("1.-------> Ajouter une reservation\n2. ------->Modifier une reservation\n3. ------->Supprimer une reservation\n4. -------> Afficher les details d'une reservation\n5. -------> afficher les statistique\n 6-----------> .Recherche des reservations \n 7. ---->quitter\n");
    printf("--------------------------------------------------------------------------------------------------\n");
}

void afficher() {
    if (count > 0) {
        printf("\n--------------------------------------------------------------------------------------------------------------");
        printf("\n|  ref  |    First Name     |       Last Name       |       Tel :       |  Age   |  Status   |      DATE      |");
        printf("\n--------------------------------------------------------------------------------------------------------------");
        for (int i = 0; i < count; i++) {
            printf("\n|%-10d|%-18s|%-22s|%-20s|%-8d|%-10d|%-15s|", i + 1, res[i].nom, res[i].prenom, res[i].Tele, res[i].age, res[i].statut, res[i].date);
            printf("\n-----------------------------------------------------------------------------------------------------------");
        }
    } else {
        printf("\nAucun\n");
    }
}

void ajoute() {
    if (count < max) {
        printf("Entrez le nom : ");
        scanf("%s", res[count].nom);
        printf("Entrez le prenom : ");
        scanf("%s", res[count].prenom);
        printf("Entrez l'age : ");
        scanf("%d", &res[count].age);
        printf("Entrez le tel : ");
        scanf("%s", res[count].Tele);
        printf("Entrez le statut ( valide ,reporte ,annule ,traite ): ");
        scanf("%s", res[count].statut);
        printf("Entrez la date : ");
        scanf("%s", res[count].date);
        count++;
    } else {
        printf("La liste est pleine.\n");
    }
}
void modifier (){
    int mod;

 //printf("entre le ref ");
 //scanf("%d" , &mod);

 char input[10];

    printf("Entrez le ref: ");
    while (1) {
        scanf("%s", input);
        mod = atoi(input);
        if (mod >= 1 && mod <= 5 && mod != 0) {
            break;
        } else {
            printf("EntrÃ©e invalide  , ressaey: ");
        }
    }



  for (int i = 0 ; i< count ; i++){
    if ((i+1) == mod ){

        printf("Entrez le nom : ");
        scanf("%s", res[i].nom);
        printf("Entrez le prenom : ");
        scanf("%s", res[i].prenom);
        printf("Entrez l'age : ");
        scanf("%d", &res[i].age);
        printf("Entrez le tel : ");
        scanf("%s", res[i].Tele);
        printf("Entrez le statut (valide ,reporte ,annule ,traite) : ");
        scanf("%s", res[i].statut);
        printf("Entrez la date : ");
        scanf("%s", res[i].date);

    }else {

    printf("invalide name ");
    }


  }

}
int main() {
     int choix;
       jump :
        menu();
        printf("Entrez votre choix : ");
        scanf("%d", &choix);
        switch (choix) {
            case 1:
                ajoute();
                goto jump;
                break;
            case 2:
                modifier();
                goto jump;
                break;
            case 3:
                suppimer();
                goto jump;
                break;
            case 4:
                afficher();
                goto jump;
                break;
            case 5:
                 statistique();
                goto jump;
                break;
            case 6 :




            case 7 :
                printf("au revoir\n");
                exit(NULL);
                break;
            default:
                printf("invalide\n");
        }
}
